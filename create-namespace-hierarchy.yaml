APIVersion: 1
label: recipe:create-workspace-platform-app
data:
  recipes:
  - name: Create a new workspace
    label: recipe:create-workspace-platform-app
    deploymentMode: Unrestricted
    metadata:
    - "@aporeto:author=aporeto"
    associatedTags:
    - "aporeto:recipe:placement=getting-started"
    targetIdentities:
    - namespaces
    longDescription: |-
      Follow these steps to create a new workspace, platform and App.

      /account/workspace/platform/app is a simple and recommended namespace hierarchy to organize
      your workloads.

      In these steps, start by selecting where you want to create your namespace hierarchy.
      Depending on which namespace you choose to start with, you will be invited to create
      the child namespace

      Each namespace will have a specific tag that you can use to define your network policies.

      Note: Two namespaces with the same name cannot exist at the same level.
    template: |-
      {{`
      APIVersion: 1
      label: recipe:create-workspace-platform-app
      data:
        namespaces:
        - name: {{ .Values.workspace }}
        {{- if (eq .Values.mode "hosts") }}
        - name: {{ .Values.hosts_platform_name}}
          namespace: {{ .Values.workspace }}
        - name: {{ .Values.hosts_app_name}}
          namespace: {{ .Values.workspace }}/{{ .Values.hosts_platform_name }}
        {{- end }}
        {{- if (eq .Values.mode "noc") }}
        - name: {{ .Values.noc_platform_name}}
          namespace: {{ .Values.workspace }}
        - name: {{ .Values.noc_app_name}}
          namespace: {{ .Values.workspace }}/{{ .Values.noc_platform_name }}
        {{- end }}
        {{- if (eq .Values.mode "oc") }}
        - name: {{ .Values.oc_platform_name}}
          namespace: {{ .Values.workspace }}
        {{- end }}
      `}}
    steps:
    - name: Namespaces
      parameters:
      - key: workspace
        name: Workspace
        description: Define your workspace name
        type: String

      - key: mode
        name: Platform
        description: Select the option that applies to your workspace
        type: Enum
        defaultValue: hosts
        allowedChoices:
          hosts: Hosts(Bare Metal, VMs)
          noc: Non-Orchestrated containers (Standalone Docker)
          oc: Orchestrated containers (OpenShift, Kubernetes)

      - key: hosts_platform_name
        name: Name
        type: String
        visibilityCondition:
        - - key: mode
            operator: Equal
            value: "hosts"

      - key: hosts_app_name
        name: Application name
        type: String
        visibilityCondition:
        - - key: mode
            operator: Equal
            value: "hosts"

      - key: noc_platform_name
        name: Name
        type: String
        visibilityCondition:
        - - key: mode
            operator: Equal
            value: "noc"

      - key: noc_app_name
        name: Application name
        type: String
        visibilityCondition:
        - - key: mode
            operator: Equal
            value: "noc"

      - key: oc_platform_name
        name: Cluster name
        type: String
        visibilityCondition:
        - - key: mode
            operator: Equal
            value: "oc"
